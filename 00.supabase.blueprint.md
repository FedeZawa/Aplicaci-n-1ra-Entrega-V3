# BLUEPRINT: Gestión de Reserva de clases (SUPABASE BaaS)
Eres un desarrollador fullstack senior especializado en Supabase y arquitecturas BaaS. Debes ayudarme a implementar un sistema de gestión de reservas de clases para un gimnasio utilizando Supabase como backend completo.

## CONTEXTO
Tengo un frontend React/PWA funcional con interfaces de admin y alumnos. Necesito agregar backend real con Supabase que incluya: persistencia, autenticación, autorización mediante RLS y coordinación en tiempo real.
El sistema de reservas ser: "Zero Trust" donde la seguridad reside en la base de datos (RLS) y la lógica compleja en Edge Functions.
Analiza el proyecto de frontend que ya tenemos realizado.

## Esquema de Datos
- **profiles**: id (uuid, fk auth.users), full_name, email (unico), role (admin/student), date_start(fecha, valor por defecto: now()), is_active (booleano, por defecto true).
Uso:
Esta tabla define los roles y permisos del sistema y centraliza los datos personales de los usuarios. Permite diferenciar entre administradores y alumnos.
- **classes**: id, name, description (texto), capacity, day_of_week, start_time(time), end_time(time), image_url (text), is_active (bool).
Uso:
Contiene la configuración general de cada clase, sin asociarla a fechas u horarios específicos.
- **class_sessions**: id (uuid, PK), class_id (uuid, FK → classes.id), schedule_id (uuid, FK → class_schedules.id), session_date (date), start_time (time), end_time (time), capacity (int), status (enum: available/cancelled/completed), created_at (timestamp).
Uso:
Esta tabla representa instancias concretas de una clase en una fecha y horario específicos. Permite gestionar sesiones individuales, incluyendo su cancelación o modificación, sin afectar la configuración recurrente de la clase.
- **reservations**: id (uuid, PK), session_id (uuid, FK → class_sessions.id), user_id (uuid, FK → profiles.id), status (enum: confirmed/cancelled), created_at (timestamp).
Uso:
Esta tabla almacena las reservas realizadas por los alumnos sobre sesiones específicas. Garantiza el control de cupos y la trazabilidad de las inscripciones, aplicando reglas como la no duplicación de reservas por alumno y la validación de capacidad disponible.
- **announcements**: id, title, content, priority, is_published.
- **app_settings**: key (PK), value (JSONB). 
  Valores iniciales sugeridos:
•	min_hours_advance: 12
•	max_active_reservations: 5
•	allow_cancellations: true
•	theme_default: light
 

## Reglas de Seguridad (RLS)
1. **Profiles**: Usuario lee su fila. Admin lee todo. Trigger auto-crea profile al registro.
2. **Classes/Announcements**: Todos leen (si están activos/publicados). Solo Admin escribe.
3. **Reservations**: Usuario lee/crea/cancela lo propio. Admin lee/modifica todo.

## Lógica de Negocio (Edge and Chrome Functions)
- **validate-booking**: Único punto de entrada para crear reservas. Valida contra `app_settings` y solapamientos antes de insertar.

## Realtime
- Habilitar `REPLICA` en la tabla `reservations` para actualizaciones instantáneas en el frontend.
